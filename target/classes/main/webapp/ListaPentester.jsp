<%@page import="Modelo.Vulnerabilidad"%>
<%@page import="java.sql.*"%>
<%@page import="Modelo.Usuario"%>
<%@page import="java.util.ArrayList"%>
<%@page contentType="text/html" pageEncoding="UTF-8"%>


<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <title>DATOS</title>
</head>

<body>
    <!--
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark">

        <a class="navbar-brand" href="#">
            <img src="https://insidesecurity.cl/inside-logo.png" alt="logo" style="width:300px;">
        </a>


        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="#">Link 1</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Link 2</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Link 3</a>
            </li>
        </ul>
        
        <div class="float-left">
        <form class="form-inline" action="/action_page.php">
            <input class="form-control mr-sm-2" type="text" placeholder="Search">
            <button class="btn btn-success" type="submit">Buscar</button>
        </form>

        <form action="Logout" method="POST">
            <input type="submit" value="cerrar Sesion" name="??" class="btn btn-primary" role="button" />
        </form>
        </div>
    </nav>
-->

    <nav class="navbar navbar-expand-lg bg-dark navbar-dark">
        <a class="navbar-brand" href="#"> <img src="https://insidesecurity.cl/inside-logo.png" alt="logo"
                style="width:300px;"> </a>
       
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Link</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Dropdown
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="#">Action</a>
                        <a class="dropdown-item" href="#">Another action</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">Something else here</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link disabled" href="#">Disabled</a>
                </li>
            </ul>

            <ul class="navbar-nav">
                <li class="nav-item">
                    <form class="form-inline my-2 my-lg-0">
                        <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
                    </form>
                </li>
                
                <li class="nav-item">
                    <form class="form-inline my-2 my-lg-0" action="Logout" method="POST">
                        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Cerrar sesion</button>
                    </form>
                </li>
            </ul>

        </div>
    </nav>


    <div class="container-fluid">
        <h3>Tabla de Vulnerabilidades</h3>
        <p>Listado de Vulnerabilidades:</p>
        <div class="table-responsive">
            <table class="table table-dark table-striped">
                <thead>
                    <tr>
                        <th>ID del docuemnto</th>
                        <th>NOMBRE</th>
                        <th>Path documento</th>
                        <th>Version Documento</th>
                        <th>hash_md5</th>
                        <th>hash_sha1</th>
                        <th>hash_sha256</th>
                        <th>Documento Relacionado</th>
                        <th>Fecha Entrega</th>
                        <th>Nro Sprint </th>
                        <th>Nombre Sprint </th>
                        <th>Estado Documento </th>
                        <th>Alcance </th>
                        <th>Conclusion </th>
                        <th>Persona </th>
                        <th>Proyecto </th>
                        <th>Celula </th>
                        <th>Usuario</th>
                        <th>Origen </th>
                        <th>Revision </th>
                        <th>Boton </th>
                    </tr>
                </thead>


                <tbody>
                    <%
            String c = (String) request.getSession().getAttribute("nombre_usuario");
            
            Connection con = null;
            Statement sta = null;
            ResultSet rs = null;
            
            HttpSession session1 = request.getSession();
            
            if (session1.getAttribute("usu") == null) {
            
                response.sendRedirect("login.jsp");
            } else {
            
                try {
                    Class.forName("com.mysql.jdbc.Driver");
                    con = DriverManager.getConnection("jdbc:mysql://localhost/backlog?user=root&password=");
                    //inicio statement             
                    sta = con.createStatement();
                    //ejecuto el select
                    rs = sta.executeQuery("select D.id_documento, D.nombre_documento, D.path_documento, D.version_documento, D.hash_md5, D.hash_sha1, D.hash_sha256, D.documento_relacionado, D.fecha_entrega, D.nro_sprint, D.nombre_sprint, D.estado_documento, D.alcance, D.conclusion, P.nombre_persona, PRO.nombre_proyecto, C.nombre_celula, U.nombre_usuario, O.nombre_origen, R.nombre_revision from documento D join persona P on D.id_persona = P.id_persona join proyecto PRO on D.id_idea = PRO.id_idea join celula C on D.id_celula = C.id_celula join usuario U on D.id_usuario = U.id_usuario join origen O on D.id_origen = O.id_origen join revision R on D.id_revision = R.id_revision where U.nombre_usuario ='" + c + "'");
                    //resultado del select se guarda en resultset
                    while (rs.next()) { //paso fila por fila y muestro el resultado en tabla
            %>

                    <tr>
                        <th scope="row"><%=rs.getString(1)%></th>
                        <td><%=rs.getString(2)%></td>
                        <td><%=rs.getString(3)%></td>
                        <td><%=rs.getString(4)%></td>
                        <td><%=rs.getString(5)%></td>
                        <td><%=rs.getString(6)%></td>
                        <td><%=rs.getString(7)%></td>
                        <td><%=rs.getString(8)%></td>
                        <td><%=rs.getString(9)%></td>
                        <td><%=rs.getString(10)%></td>
                        <td><%=rs.getString(11)%></td>
                        <td><%=rs.getString(12)%></td>
                        <td><%=rs.getString(13)%></td>
                        <td><%=rs.getString(14)%></td>
                        <td><%=rs.getString(15)%></td>
                        <td><%=rs.getString(16)%></td>
                        <td><%=rs.getString(17)%></td>
                        <td><%=rs.getString(18)%></td>
                        <td><%=rs.getString(19)%></td>
                        <td><%=rs.getString(20)%></td>
                        <td><a href="SMostarDoc?id_documento=<%=rs.getString(1)%>">ELIGIR</a></td>
                    </tr>
                </tbody>
                <%
                            }

                        } catch (Exception e) {

                        }
                    }
                %>
            </table>
        </div>
    </div>
    <center><a href="menu.jsp"><button type="button" class="btn btn-secondary">Volver..</button></a></center>
</body>

</html>